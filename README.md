# 🚀 Stogram - Современный PWA Мессенджер

<div align="center">

![Stogram_logo](https://s3.iimg.su/s/31/th_gDR2WHgxsYtJ8dedtLK18pvduN1dnk8QEonQ95Ii.png)

**Современное, многофункциональное Progressive Web приложение (PWA) мессенджер с E2E шифрованием, продвинутыми ботами и аналитикой**

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![Version](https://img.shields.io/badge/Version-2.0.0-brightgreen.svg)](https://github.com/)
[![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)](https://nodejs.org/)
[![React](https://img.shields.io/badge/React-18+-61dafb.svg)](https://reactjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5+-3178c6.svg)](https://www.typescriptlang.org/)

</div>

---

## 📋 Содержание

- [Обзор](#обзор)
- [Возможности](#возможности)
- [Платформы](#платформы)
- [Технологический стек](#технологический-стек)
- [Архитектура](#архитектура)
- [Быстрый старт](#быстрый-старт)
- [Документация](#документация)
- [Проверка типизации](#проверка-типизации)
- [Скриншоты](#скриншоты)
- [Участие в разработке](#участие-в-разработке)
- [Лицензия](#лицензия)

---

## 🌟 Обзор

**Stogram** - это современная платформа для обмена сообщениями, объединяющая лучшие функции популярных мессенджеров, таких как Telegram, с передовыми веб-технологиями. Созданный как Progressive Web Application, Stogram работает без проблем на всех устройствах и платформах, обеспечивая нативный опыт использования прямо в вашем браузере.

### Почему Stogram?

- 🌐 **Кроссплатформенность**: Работает на десктопе, мобильных устройствах и планшетах - везде, где есть современный браузер
- 📱 **PWA Технология**: Устанавливается на любое устройство как нативное приложение
- 🔒 **E2E Шифрование**: Полная реализация end-to-end шифрования с RSA-2048 и AES-256
- 🛡️ **2FA Защита**: Двухфакторная аутентификация с TOTP и backup кодами
- ⚡ **Реальное время**: WebSocket-обмен мгновенными сообщениями с Socket.IO
- 🎥 **Богатые медиа**: Видео и аудио звонки на базе WebRTC, автоматическое сжатие
- 💾 **Офлайн поддержка**: Service Workers обеспечивают офлайн функциональность
- 🎨 **Кастомизация UI**: Полная настройка тем оформления и цветовых схем
- 📊 **Аналитика**: Детальная статистика использования и dashboard
- 🤖 **Продвинутые боты**: Inline клавиатуры, callback запросы, inline режим
- ⚡ **Производительность**: Redis кэширование, виртуализация списков, ленивая загрузка
- 🔧 **Расширяемость**: Хорошо структурированная кодовая база для лёгкой кастомизации

### 🎉 Новое в версии 2.0.0

- ✨ **E2E Шифрование**: Полная реализация с генерацией ключей и обменом
- 🎬 **Обработка медиа**: Автоматическое сжатие, конвертация видео, генерация превью
- 🤖 **Расширенные боты**: Inline клавиатуры, callback/inline запросы
- 📊 **Аналитика**: Статистика пользователей, ботов, системы
- 🎨 **Темы**: Редактор тем с полной кастомизацией цветов
- ⚡ **Оптимизация**: Виртуализация, Redis кэш, ленивая загрузка
- 🔐 **Безопасность**: 2FA, IP блокировка, логирование, защита от спама

---

## 📱 Платформы

Stogram доступен на нескольких платформах:

### 🌐 Web (PWA)
- **Технология**: React + Vite
- **Статус**: ✅ Полностью реализовано
- **Папка**: `/client`
- Работает в любом современном браузере
- Может быть установлено как PWA на любое устройство
- Offline-first архитектура

### 📱 Mobile (React Native)
- **Технология**: React Native
- **Статус**: 🚧 В активной разработке (65%)
- **Папка**: `/mobile`
- **Платформы**: iOS 13.0+, Android 6.0+
- Нативное приложение для мобильных устройств
- Полная интеграция с существующим backend
- [Подробная документация →](./mobile/README.md)
- [Статус реализации →](./mobile/IMPLEMENTATION_STATUS.md)

### 🖥 Desktop
- **Статус**: ⏳ Запланировано
- Возможные технологии: Electron, Tauri
- Нативный desktop опыт для Windows, macOS, Linux

---

## ✨ Возможности

### 🔐 Аутентификация и безопасность

- **Регистрация по Email/паролю**: Безопасное создание аккаунта с валидацией
- **Система входа**: Аутентификация по имени пользователя или email
- **JWT токены**: Безопасная аутентификация без состояния
- **Безопасность паролей**: Bcrypt хеширование с настраиваемым количеством раундов
- **E2E Шифрование**: RSA-2048 для обмена ключами, AES-256 для сообщений и файлов
- **2FA Аутентификация**: TOTP с QR кодами и backup кодами
- **IP Блокировка**: Автоматическая и ручная блокировка подозрительных IP
- **Логирование безопасности**: Полная история всех действий безопасности
- **Brute Force защита**: Блокировка аккаунта после неудачных попыток входа
- **Доверенные IP**: Список доверенных IP адресов
- **Ограничение частоты запросов**: Защита от brute force атак через Redis

### 💬 Обмен сообщениями

- **Сообщения в реальном времени**: Мгновенная доставка через WebSockets
- **Приватные чаты**: Общение один-на-один
- **Групповые чаты**: Групповой обмен сообщениями для нескольких пользователей
- **Каналы**: Трансляция сообщений множеству пользователей
- **Типы сообщений**: Текст, изображения, видео, аудио, файлы, голосовые сообщения
- **Обмен файлами**: Загрузка и обмен файлами до 10МБ
- **Редактирование сообщений**: Редактирование отправленных сообщений
- **Удаление сообщений**: Удаление сообщений для себя или для всех
- **Функция ответа**: Ответ на конкретные сообщения
- **Индикаторы набора**: Видно, когда другие печатают
- **Отметки о прочтении**: Отслеживание доставки и статуса прочтения сообщений
- **Поиск сообщений**: Поиск сообщений по всем чатам
- **Стикеры**: Полная система стикеров с паками
- **Упоминания (@)**: Упоминание пользователей в чатах
- **Хэштеги (#)**: Организация сообщений с хэштегами
- **Тихий режим**: Отправка сообщений без уведомлений
- **Закрепление сообщений**: Закрепление важных сообщений в чате
- **Запланированные сообщения**: Отправка сообщений в определённое время
- **Реакции на сообщения**: Эмодзи реакции на сообщения

### 📞 Голосовые и видео звонки

- **Аудио звонки**: Высококачественная голосовая связь
- **Видео звонки**: Видео разговоры лицом к лицу
- **WebRTC технология**: Peer-to-peer соединение с низкой задержкой
- **Управление звонками**: Включение/отключение микрофона и видео
- **История звонков**: Отслеживание входящих, исходящих и пропущенных звонков
- **Групповые звонки**: Аудио/видео звонки с несколькими участниками
- **Запись звонков**: Запись аудио и видео звонков
- **Шумоподавление**: Подавление фонового шума во время звонков

### 👥 Управление пользователями

- **Профили пользователей**: Настраиваемое отображаемое имя, аватар и био
- **Статус пользователя**: Онлайн, Офлайн, Отошёл, Не беспокоить
- **Последнее посещение**: Отслеживание, когда пользователи были активны в последний раз
- **Управление контактами**: Добавление и организация контактов
- **Поиск пользователей**: Поиск пользователей по имени, email или отображаемому имени
- **Фотографии профиля**: Загрузка и отображение аватаров
- **Настройки приватности**: Управление видимостью онлайн-статуса, фото профиля и времени последнего посещения
- **Блокировка пользователей**: Блокировка нежелательных пользователей

### 🎨 Пользовательский интерфейс

- **Современный дизайн**: Чистый интерфейс в стиле Telegram
- **Адаптивная вёрстка**: Адаптируется к любому размеру экрана
- **Тёмная тема**: Поддержка светлой и тёмной темы
- **Плавные анимации**: Отполированные переходы и эффекты
- **Поддержка эмодзи**: Полная интеграция эмодзи
- **Предпросмотр файлов**: Предпросмотр изображений и видео внутри интерфейса
- **Система уведомлений**: Toast-уведомления о событиях
- **Состояния загрузки**: Скелетные экраны и спиннеры
- **Папки чатов**: Организация чатов по пользовательским папкам
- **Избранное**: Быстрый доступ к важным чатам
- **Архивация чатов**: Архивация старых чатов

### 📱 Telegram интеграция

- **Telegram Bot**: Полнофункциональный бот для уведомлений и управления
- **Telegram Login**: Быстрая авторизация через Telegram аккаунт
- **Уведомления в Telegram**: Получение уведомлений о новых сообщениях
- **Мосты для чатов**: Двусторонняя синхронизация между Telegram и Stogram
- **Telegram Mini App**: Полноценное приложение внутри Telegram
- **Команды бота**: /start, /status, /notifications, /bridge, /help
- **Синхронизация профиля**: Автоматическое обновление данных из Telegram
- **Групповые чаты**: Синхронизация групповых чатов Telegram
- [Документация по интеграции →](./TELEGRAM_INTEGRATION.md)
- [Руководство по настройке →](./TELEGRAM_SETUP_GUIDE.md)
- [Примеры API →](./TELEGRAM_API_EXAMPLES.md)

### 🔔 Уведомления

- **Push-уведомления**: Браузерные push-уведомления (PWA)
- **Оповещения о сообщениях**: Мгновенные уведомления о новых сообщениях
- **Уведомления о звонках**: Звонок при входящих вызовах
- **Настраиваемость**: Управление настройками уведомлений
- **Отключение звука для чатов**: Отключение уведомлений для конкретных чатов
- **Бейджи непрочитанных**: Счётчик непрочитанных сообщений

### 🌐 Progressive Web App

- **Устанавливаемость**: Добавление на главный экран на любом устройстве
- **Офлайн режим**: Доступ к кэшированному контенту без интернета
- **Быстрая загрузка**: Стратегии кэширования Service Worker
- **App-like опыт**: Полноэкранный режим, нативные жесты
- **Автообновления**: Беспрепятственные обновления приложения

### 🤖 Боты и интеграции

- **Bot API**: Создание и управление ботами
- **Inline боты**: Боты, работающие inline в чатах
- **Команды ботов**: Определение пользовательских команд
- **Вебхуки**: Интеграция с внешними сервисами
- **n8n интеграция**: Специальные API для автоматизации
- **Telegram интеграция**: Мосты и интеграции с Telegram

---

## 🛠 Технологический стек

### Frontend

- **React 18**: Современная UI библиотека с хуками и конкурентными возможностями
- **TypeScript**: Разработка с типобезопасностью
- **Vite**: Молниеносная система сборки и dev-сервер
- **TailwindCSS**: Utility-first CSS фреймворк
- **Zustand**: Легковесное управление состоянием
- **Socket.IO Client**: WebSocket коммуникация в реальном времени
- **Axios**: HTTP клиент для API запросов
- **React Router**: Роутинг на стороне клиента
- **Lucide React**: Красивый набор иконок
- **React Hot Toast**: Элегантная система уведомлений
- **date-fns**: Современная библиотека утилит для дат
- **Workbox**: Управление Service Worker для PWA

### Backend

- **Node.js**: JavaScript runtime
- **Express**: Фреймворк веб-приложений
- **TypeScript**: Разработка типобезопасного сервера
- **Socket.IO**: Двунаправленная коммуникация в реальном времени
- **Prisma**: Современный ORM для управления базой данных
- **PostgreSQL**: Надёжная реляционная база данных
- **Redis**: In-memory хранилище данных для сессий и кэширования
- **JWT**: JSON Web Tokens для аутентификации
- **bcrypt**: Хеширование паролей
- **Multer**: Обработка загрузки файлов
- **Zod**: Валидация схемы
- **Helmet**: Middleware для безопасности
- **CORS**: Cross-origin resource sharing
- **Sharp**: Обработка изображений
- **FFmpeg**: Обработка медиа
- **node-cron**: Планирование задач
- **web-push**: Push-уведомления

### DevOps и инфраструктура

- **Docker**: Контейнеризация
- **Docker Compose**: Оркестрация мульти-контейнеров
- **Nginx**: Веб-сервер и обратный прокси
- **Git**: Контроль версий

---

## 🏗 Архитектура

### Системная архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                      Клиентский уровень                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   Браузер    │  │   Мобильный  │  │   Десктоп    │      │
│  │     PWA      │  │     PWA      │  │     PWA      │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│         │                  │                  │              │
│         └──────────────────┴──────────────────┘              │
│                          │                                   │
│                    WebSocket + HTTP                          │
│                          │                                   │
└──────────────────────────┼───────────────────────────────────┘
                           │
┌──────────────────────────┼───────────────────────────────────┐
│                  Уровень приложения                          │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              Express.js Сервер                       │    │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────────┐  │    │
│  │  │   REST   │  │ Socket.IO│  │  WebRTC Сигнал   │  │    │
│  │  │   API    │  │  Сервер  │  │     Сервер       │  │    │
│  │  └──────────┘  └──────────┘  └──────────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│           │                │                   │             │
│     ┌─────┴────┐     ┌─────┴─────┐      ┌─────┴──────┐     │
│     │   Авториз│     │ Сообщения │      │   Звонки   │     │
│     │  Сервис  │     │  Сервис   │      │   Сервис   │     │
│     └──────────┘     └───────────┘      └────────────┘     │
└──────────────────────────┼───────────────────────────────────┘
                           │
┌──────────────────────────┼───────────────────────────────────┐
│                     Уровень данных                           │
│  ┌──────────────┐    ┌─────────┐    ┌──────────────┐       │
│  │  PostgreSQL  │    │  Redis  │    │  Хранилище   │       │
│  │ База данных  │    │   Кэш   │    │    файлов    │       │
│  └──────────────┘    └─────────┘    └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
```

### Схема базы данных

```
User (Пользователь)
├── id (UUID, PK)
├── email (уникальный)
├── username (уникальный)
├── password (хешированный)
├── displayName
├── avatar
├── bio
├── status (enum)
├── lastSeen
├── showOnlineStatus
├── showProfilePhoto
├── showLastSeen
└── timestamps

Chat (Чат)
├── id (UUID, PK)
├── name
├── type (PRIVATE|GROUP|CHANNEL)
├── avatar
├── description
├── isSecret
└── timestamps

ChatMember (Участник чата)
├── id (UUID, PK)
├── userId (FK → User)
├── chatId (FK → Chat)
├── role (OWNER|ADMIN|MEMBER)
└── joinedAt

Message (Сообщение)
├── id (UUID, PK)
├── content
├── type (enum)
├── senderId (FK → User)
├── chatId (FK → Chat)
├── replyToId (FK → Message)
├── fileUrl
├── fileName
├── fileSize
├── stickerId
├── isEdited
├── isDeleted
├── isSilent
├── mentions[]
├── hashtags[]
└── timestamps

StickerPack (Пак стикеров)
├── id (UUID, PK)
├── name
├── slug (уникальный)
├── description
├── thumbnail
├── isPublic
└── stickers[]

Bot (Бот)
├── id (UUID, PK)
├── username (уникальный)
├── displayName
├── token (уникальный)
├── isActive
├── isInline
└── commands[], webhooks[]
```

---

## 🚀 Быстрый старт

### Требования

- Node.js 18+ и npm
- Docker и Docker Compose (для контейнеризованного развёртывания)
- PostgreSQL 15+ (если запуск без Docker)
- Redis (опционально, для управления сессиями)

### Локальная разработка

1. **Клонировать репозиторий**

```bash
git clone <repository-url>
cd stogram
```

2. **Установить зависимости**

```bash
npm run install:all
```

3. **Настроить переменные окружения**

Сервер (.env):
```bash
cp server/.env.example server/.env
# Отредактируйте server/.env с вашей конфигурацией
```

Клиент (.env):
```bash
cp client/.env.example client/.env
# Отредактируйте client/.env с вашей конфигурацией
```

4. **Запустить PostgreSQL и Redis**

```bash
docker-compose up -d postgres redis
```

5. **Настроить базу данных**

```bash
cd server
npx prisma migrate dev
npx prisma generate
cd ..
```

6. **Запустить серверы разработки**

```bash
npm run dev
```

Приложение будет доступно по адресам:
- Frontend: http://localhost:5173
- Backend: http://localhost:3001

### Развёртывание через Docker

1. **Настроить переменные окружения**

```bash
cp .env.example .env
# Отредактируйте файл .env с настройками для продакшна
```

2. **Собрать и запустить контейнеры**

```bash
docker-compose up -d --build
```

3. **Доступ к приложению**

- Приложение: http://localhost
- API: http://localhost:3001

Для детальных инструкций по развёртыванию см. [DEPLOYMENT.md](./DEPLOYMENT.md).

---

## ✅ Проверка типизации

Проект использует TypeScript с строгой типизацией для обеспечения качества кода.

### Проверка типов в клиенте

```bash
cd client
npm run build
# или
npx tsc --noEmit
```

### Проверка типов в сервере

```bash
cd server
npx tsc --noEmit
```

### Статус типизации

✅ **Клиент**: Все TypeScript ошибки исправлены
- Исправлены импорты неиспользуемых компонентов в BotManager
- Исправлен неверный тип события в AudioVisualizer (seek → interaction)

✅ **Сервер**: Все TypeScript ошибки исправлены  
- Добавлены глобальные типы для Express Request (расширение с user и userId)
- Исправлены все неявные типы 'any' в контроллерах и сервисах
- Исправлены типы в JWT sign options
- Добавлены явные типы для callback функций в reduce, map, filter, forEach

### Конфигурация

**Клиент** (`client/tsconfig.json`):
- Strict mode включен
- noUnusedLocals и noUnusedParameters включены
- JSX: react-jsx

**Сервер** (`server/tsconfig.json`):
- Strict mode включен
- Добавлены кастомные типы в `src/types/express.d.ts`
- TypeRoots настроены для поддержки глобальных типов

---

## 📚 Документация

**📖 [Complete Documentation →](./docs/README.md)**

### 👥 User Documentation
- **[User Guide](./docs/user-guide/USER_GUIDE.md)**: Complete guide for end users
- **[Features Overview](./docs/user-guide/FEATURES.md)**: All available features and capabilities

### 🔧 Developer Documentation
- **[Architecture](./docs/development/ARCHITECTURE.md)**: System architecture and design
- **[Contributing Guide](./CONTRIBUTING.md)**: How to contribute to the project
- **[API Documentation](./docs/api/)**: REST and WebSocket API reference

### 🚀 Deployment & Setup
- **[Deployment Guide](./docs/deployment/DEPLOYMENT.md)**: Production deployment instructions
- **[Quick Start](./docs/deployment/QUICKSTART.md)**: Automated setup guide
- **[Migration Guide](./docs/deployment/MIGRATION.md)**: Database migration instructions

### 🔌 Integrations
- **[Telegram Integration](./docs/api/TELEGRAM.md)**: Complete Telegram integration guide
- **[Telegram Setup](./docs/api/TELEGRAM_SETUP.md)**: Step-by-step setup instructions
- **[Telegram API Examples](./docs/api/TELEGRAM_EXAMPLES.md)**: API usage examples

### 📱 Mobile Application
- **[Mobile Documentation](./docs/mobile/README.md)**: React Native mobile app documentation
- **[Mobile Status](./docs/mobile/STATUS.md)**: Implementation status and roadmap
- **[Features Checklist](./docs/mobile/CHECKLIST.md)**: Mobile features checklist

### 🇷🇺 Русская документация
- **[Полная документация](./docs/ru/README.md)**: Complete documentation in Russian
- **[Статус реализации](./docs/ru/STATUS.md)**: Implementation status in Russian

### 📝 Reference
- **[Security Policy](./SECURITY.md)**: Security guidelines and reporting
- **[Changelog](./CHANGELOG.md)**: Version history and changes

---

## 📸 Скриншоты

### Вход и регистрация
<div align="center">
  <img src="https://via.placeholder.com/400x300/0088cc/ffffff?text=Экран+входа" alt="Вход" width="400"/>
  <img src="https://via.placeholder.com/400x300/0088cc/ffffff?text=Экран+регистрации" alt="Регистрация" width="400"/>
</div>

### Интерфейс чата
<div align="center">
  <img src="https://via.placeholder.com/800x500/0088cc/ffffff?text=Интерфейс+чата" alt="Интерфейс чата"/>
</div>

### Видео звонок
<div align="center">
  <img src="https://via.placeholder.com/800x500/0088cc/ffffff?text=Видео+звонок" alt="Видео звонок"/>
</div>

---

## 🤝 Участие в разработке

Мы приветствуем вклад в проект! Пожалуйста, следуйте этим шагам:

1. Форкните репозиторий
2. Создайте ветку функции (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте ваши изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

Подробнее см. [CONTRIBUTING.md](./CONTRIBUTING.md)

---

## 📄 Лицензия

Этот проект лицензирован под лицензией MIT - см. файл [LICENSE](LICENSE) для деталей.

---

## 🙏 Благодарности

- Дизайн вдохновлён Telegram
- Иконки от Lucide
- Создано с любовью используя React и Node.js

---

## 📞 Поддержка

- 📧 Email: support@stogram.com
- 💬 Discord: [Присоединяйтесь к нашему сообществу](https://discord.gg/stogram)
- 🐛 Issues: [GitHub Issues](https://github.com/yourusername/stogram/issues)

---

<div align="center">
  <p>Создано с ❤️ командой Stogram</p>
  <p>⭐ Поставьте звезду на GitHub, если вам нравится этот проект!</p>
</div>
